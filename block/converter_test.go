package block

import (
	"encoding/base64"
	"github.com/streamingfast/firehose-aelf/pb/aelf"
	"github.com/test-go/testify/assert"
	"google.golang.org/protobuf/proto"
	"testing"
)

func TestConvertBlock(t *testing.T) {
	blockSample := "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a2VuU3ltYm9sEAESXApYSlJtQmR1aDRuWFdpMWFYZ2RVc2o1Z0pyemVaYjJMeG1yQWJmN1c5OWZhWlN2b0FhRS9UcmFuc2FjdGlvbkZlZUZyZWVBbGxvd2FuY2VzU3ltYm9sTGlzdBABUp4CCiIKIGtUK/wnUdttDMGu9LiwcbE0gMlH3JsmO4GR+4EEUGQ9EhhNaW5pbmdJbmZvcm1hdGlvblVwZGF0ZWQahQEKggEwNDRmMzU1YmRjYjdjYzBhZjcyOGVmM2NjZWI5NjE1ZDkwNjg0YmI1YjJjYTVmODU5YWIwZjBiNzA0MDc1ODcxYWEzODViNmIxYjhlYWQ4MDljYTY3NDU0ZDk2ODNmY2YyYmEwMzQ1NmQ2ZmUyYzRhYmUyYjA3ZjBmYmRiYjJmMWMxGg4SDAi5s/u5BhCAqpuZARocGhpVcGRhdGVUaW55QmxvY2tJbmZvcm1hdGlvbhoCIGEaJCoiCiBu2DOB2OQo1fNC2WQBL+Z3M8bN0XZxfZWBk4T50uFfnliKc2ABascSCtcECjpwR2E0ZTVoTkdzZ2tmakVHbTcyVEV2YkY3YVJEcUtCZDRMdVh0YWI0dWNNYlhMY2dKL1JvdW5kcy83EpgECAcShgMKggEwNDRmMzU1YmRjYjdjYzBhZjcyOGVmM2NjZWI5NjE1ZDkwNjg0YmI1YjJjYTVmODU5YWIwZjBiNzA0MDc1ODcxYWEzODViNmIxYjhlYWQ4MDljYTY3NDU0ZDk2ODNmY2YyYmEwMzQ1NmQ2ZmUyYzRhYmUyYjA3ZjBmYmRiYjJmMWMxEv4BCAEQATIGCLyz+7kGOGBKggEwNDRmMzU1YmRjYjdjYzBhZjcyOGVmM2NjZWI5NjE1ZDkwNjg0YmI1YjJjYTVmODU5YWIwZjBiNzA0MDc1ODcxYWEzODViNmIxYjhlYWQ4MDljYTY3NDU0ZDk2ODNmY2YyYmEwMzQ1NmQ2ZmUyYzRhYmUyYjA3ZjBmYmRiYjJmMWMxagYIuLP7uQZqCwi4s/u5BhDYnrxCagwIuLP7uQYQqJzSkAFqDAi4s/u5BhC4+8T0AWoMCLiz+7kGEOCnybsCagwIuLP7uQYQwJaDsgNqCwi5s/u5BhDgj9FBagwIubP7uQYQgKqbmQGAAQggMiqCATA0NGYzNTViZGNiN2NjMGFmNzI4ZWYzY2NlYjk2MTVkOTA2ODRiYjViMmNhNWY4NTlhYjBmMGI3MDQwNzU4NzFhYTM4NWI2YjFiOGVhZDgwOWNhNjc0NTRkOTY4M2ZjZjJiYTAzNDU2ZDZmZTJjNGFiZTJiMDdmMGZiZGJiMmYxYzEwAThCQAUK5AEKT3BHYTRlNWhOR3Nna2ZqRUdtNzJURXZiRjdhUkRxS0JkNEx1WHRhYjR1Y01iWExjZ0ovTGF0ZXN0UHVia2V5VG9UaW55QmxvY2tzQ291bnQSkAEKggEwNDRmMzU1YmRjYjdjYzBhZjcyOGVmM2NjZWI5NjE1ZDkwNjg0YmI1YjJjYTVmODU5YWIwZjBiNzA0MDc1ODcxYWEzODViNmIxYjhlYWQ4MDljYTY3NDU0ZDk2ODNmY2YyYmEwMzQ1NmQ2ZmUyYzRhYmUyYjA3ZjBmYmRiYjJmMWMxEKj//////////wEK6QQKTHBHYTRlNWhOR3Nna2ZqRUdtNzJURXZiRjdhUkRxS0JkNEx1WHRhYjR1Y01iWExjZ0ovUm91bmRCZWZvcmVMYXRlc3RFeGVjdXRpb24SmAQIBxKGAwqCATA0NGYzNTViZGNiN2NjMGFmNzI4ZWYzY2NlYjk2MTVkOTA2ODRiYjViMmNhNWY4NTlhYjBmMGI3MDQwNzU4NzFhYTM4NWI2YjFiOGVhZDgwOWNhNjc0NTRkOTY4M2ZjZjJiYTAzNDU2ZDZmZTJjNGFiZTJiMDdmMGZiZGJiMmYxYzES/gEIARABMgYIvLP7uQY4YEqCATA0NGYzNTViZGNiN2NjMGFmNzI4ZWYzY2NlYjk2MTVkOTA2ODRiYjViMmNhNWY4NTlhYjBmMGI3MDQwNzU4NzFhYTM4NWI2YjFiOGVhZDgwOWNhNjc0NTRkOTY4M2ZjZjJiYTAzNDU2ZDZmZTJjNGFiZTJiMDdmMGZiZGJiMmYxYzFqBgi4s/u5BmoLCLiz+7kGENievEJqDAi4s/u5BhConNKQAWoMCLiz+7kGELj7xPQBagwIuLP7uQYQ4KfJuwJqDAi4s/u5BhDAloOyA2oLCLmz+7kGEOCP0UFqDAi5s/u5BhCAqpuZAYABCCAyKoIBMDQ0ZjM1NWJkY2I3Y2MwYWY3MjhlZjNjY2ViOTYxNWQ5MDY4NGJiNWIyY2E1Zjg1OWFiMGYwYjcwNDA3NTg3MWFhMzg1YjZiMWI4ZWFkODA5Y2E2NzQ1NGQ5NjgzZmNmMmJhMDM0NTZkNmZlMmM0YWJlMmIwN2YwZmJkYmIyZjFjMTABOEJABQpnCkFwR2E0ZTVoTkdzZ2tmakVHbTcyVEV2YkY3YVJEcUtCZDRMdVh0YWI0dWNNYlhMY2dKL1JhbmRvbUhhc2hlcy85NxIiCiBNGT3qqI+98IVcThweEZD3VFD31h60GaKGXC+Xmo8cfwpMCkZwR2E0ZTVoTkdzZ2tmakVHbTcyVEV2YkY3YVJEcUtCZDRMdVh0YWI0dWNNYlhMY2dKL0xhdGVzdEV4ZWN1dGVkSGVpZ2h0EgLCARJICkRwR2E0ZTVoTkdzZ2tmakVHbTcyVEV2YkY3YVJEcUtCZDRMdVh0YWI0dWNNYlhMY2dKL0N1cnJlbnRSb3VuZE51bWJlchABEj4KOnBHYTRlNWhOR3Nna2ZqRUdtNzJURXZiRjdhUkRxS0JkNEx1WHRhYjR1Y01iWExjZ0ovUm91bmRzLzcQARI+CjpwR2E0ZTVoTkdzZ2tmakVHbTcyVEV2YkY3YVJEcUtCZDRMdVh0YWI0dWNNYlhMY2dKL1JvdW5kcy82EAESQQo9cEdhNGU1aE5Hc2drZmpFR203MlRFdmJGN2FSRHFLQmQ0THVYdGFiNHVjTWJYTGNnSi9Jc01haW5DaGFpbhABElMKT3BHYTRlNWhOR3Nna2ZqRUdtNzJURXZiRjdhUkRxS0JkNEx1WHRhYjR1Y01iWExjZ0ovTGF0ZXN0UHVia2V5VG9UaW55QmxvY2tzQ291bnQQARJQCkxwR2E0ZTVoTkdzZ2tmakVHbTcyVEV2YkY3YVJEcUtCZDRMdVh0YWI0dWNNYlhMY2dKL1JvdW5kQmVmb3JlTGF0ZXN0RXhlY3V0aW9uEAESRQpBcEdhNGU1aE5Hc2drZmpFR203MlRFdmJGN2FSRHFLQmQ0THVYdGFiNHVjTWJYTGNnSi9SYW5kb21IYXNoZXMvOTYQARJFCkFwR2E0ZTVoTkdzZ2tmakVHbTcyVEV2YkY3YVJEcUtCZDRMdVh0YWI0dWNNYlhMY2dKL1JhbmRvbUhhc2hlcy85NxABEkoKRnBHYTRlNWhOR3Nna2ZqRUdtNzJURXZiRjdhUkRxS0JkNEx1WHRhYjR1Y01iWExjZ0ovTGF0ZXN0RXhlY3V0ZWRIZWlnaHQQARJTCk9wR2E0ZTVoTkdzZ2tmakVHbTcyVEV2YkY3YVJEcUtCZDRMdVh0YWI0dWNNYlhMY2dKL0lzUHJldmlvdXNCbG9ja0luU2V2ZXJlU3RhdHVzEAEaywcKIgogsC/DJ0r381SIwbFLhdoyIoqtykVbJtxDcaOxAp48pV0ioQEKIgogQeFf/hK2c5UiOm8a618MrQcaIvboem8BoenJyvaJjTsSIgogJ5HpkqV/KOdaEfE68sCuyLDrNdLwSNQuuokByS4DeNwYYCoVQ2hhcmdlVHJhbnNhY3Rpb25GZWVzMj4KE0RvbmF0ZVJlc291cmNlVG9rZW4SIgogJ5HpkqV/KOdaEfE68sCuyLDrNdLwSNQuuokByS4DeNwYoOTCDCrdAQoiCiBJkd7+cToOJHB2A04tVAP/1xEMMT8BHvXJvjFfGShs9xICCAFY9k9gAWqtARJNCklKUm1CZHVoNG5YV2kxYVhnZFVzajVnSnJ6ZVpiMkx4bXJBYmY3Vzk5ZmFaU3ZvQWFFL0NoYWluUHJpbWFyeVRva2VuU3ltYm9sEAESXApYSlJtQmR1aDRuWFdpMWFYZ2RVc2o1Z0pyemVaYjJMeG1yQWJmN1c5OWZhWlN2b0FhRS9UcmFuc2FjdGlvbkZlZUZyZWVBbGxvd2FuY2VzU3ltYm9sTGlzdBABWO5LYAFqmwQKeQpTSlJtQmR1aDRuWFdpMWFYZ2RVc2o1Z0pyemVaYjJMeG1yQWJmN1c5OWZhWlN2b0FhRS9MYXRlc3RUb3RhbFJlc291cmNlVG9rZW5zTWFwc0hhc2gSIgogsM7eP/HgSeyXvyq1qspSlpzxe5WI0LfkLUSsoS56GX8KWApSSlJtQmR1aDRuWFdpMWFYZ2RVc2o1Z0pyemVaYjJMeG1yQWJmN1c5OWZhWlN2b0FhRS9Eb25hdGVSZXNvdXJjZVRva2VuRXhlY3V0ZUhlaWdodBICxAESRwpDSlJtQmR1aDRuWFdpMWFYZ2RVc2o1Z0pyemVaYjJMeG1yQWJmN1c5OWZhWlN2b0FhRS9Db25zZW5zdXNDb250cmFjdBABEkoKRkpSbUJkdWg0blhXaTFhWGdkVXNqNWdKcnplWmIyTHhtckFiZjdXOTlmYVpTdm9BYUUvRGl2aWRlbmRQb29sQ29udHJhY3QQARJXClNKUm1CZHVoNG5YV2kxYVhnZFVzajVnSnJ6ZVpiMkx4bXJBYmY3Vzk5ZmFaU3ZvQWFFL0xhdGVzdFRvdGFsUmVzb3VyY2VUb2tlbnNNYXBzSGFzaBABElYKUkpSbUJkdWg0blhXaTFhWGdkVXNqNWdKcnplWmIyTHhtckFiZjdXOTlmYVpTdm9BYUUvRG9uYXRlUmVzb3VyY2VUb2tlbkV4ZWN1dGVIZWlnaHQQAQ=="
	data, err := base64.StdEncoding.DecodeString(blockSample)
	assert.NoError(t, err)
	var blk aelf.Block
	err = proto.Unmarshal(data, &blk)
	assert.NoError(t, err)
	newBlck := ConvertBlock("1565beb096ff73391ae828395fddb355c70dab49e943909b31555eaaf08b80fd", &blk)
	assert.Equal(t, int64(97), newBlck.Height)
	assert.Equal(t, "1565beb096ff73391ae828395fddb355c70dab49e943909b31555eaaf08b80fd", newBlck.BlockHash)
}
